generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id Int @id @default(autoincrement())

  email      String  @unique
  first_name String
  last_name  String
  avatar     String?
  password   String

  created_at DateTime  @default(now())
  updated_at DateTime?

  setting           Setting?
  favoriteAddresses FavoriteAddress[]

  @@map("users")
}

model Package {
  id Int @id @default(autoincrement())

  type           String  @unique
  name           String
  requests_limit Int
  price          BigInt  @default(0)
  is_active      Boolean @default(false)

  created_at DateTime  @default(now())
  updated_at DateTime?

  @@map("packages")
}

model Metropolitan {
  id Int @id @default(autoincrement())

  code String @unique
  name String

  created_at DateTime  @default(now())
  updated_at DateTime?

  zipCodes ZipCodesOnMetropolitans[]

  @@map("metropolitans")
}

model State {
  id Int @id @default(autoincrement())

  code String @unique
  name String

  created_at DateTime  @default(now())
  updated_at DateTime?

  counties County[]

  @@map("states")
}

model County {
  id Int @id @default(autoincrement())

  state_id Int
  code     String @unique
  name     String

  created_at DateTime  @default(now())
  updated_at DateTime?

  state    State                @relation(fields: [state_id], references: [id])
  zipCodes ZipCodesOnCounties[]

  @@map("counties")
}

model ZipCode {
  id Int @id @default(autoincrement())

  code  String  @unique
  price Decimal

  created_at DateTime  @default(now())
  updated_at DateTime?

  counties      ZipCodesOnCounties[]
  metropolitans ZipCodesOnMetropolitans[]
  addresses     Address[]

  @@map("zip_codes")
}

model ZipCodesOnCounties {
  zip_code_id Int      @map("zip_code_id")
  county_id   Int      @map("county_id")
  created_at  DateTime @default(now())

  zipCode ZipCode @relation(fields: [zip_code_id], references: [id])
  county  County  @relation(fields: [county_id], references: [id])

  @@id([zip_code_id, county_id])
  @@map("county_zip_code")
}

model ZipCodesOnMetropolitans {
  zip_code_id     Int
  metropolitan_id Int
  created_at      DateTime @default(now())

  zipCode      ZipCode      @relation(fields: [zip_code_id], references: [id])
  metropolitan Metropolitan @relation(fields: [metropolitan_id], references: [id])

  @@id([zip_code_id, metropolitan_id])
  @@map("metropolitan_zip_code")
}

model Setting {
  id Int @id @default(autoincrement())

  user_id Int  @unique
  data    Json

  created_at DateTime  @default(now())
  updated_at DateTime?

  user User @relation(fields: [user_id], references: [id])

  @@map("settings")
}

model Address {
  id Int @id @default(autoincrement())

  zip_code_id Int
  address     String
  link        String
  info        Json?

  created_at DateTime  @default(now())
  updated_at DateTime?

  zipCode           ZipCode           @relation(fields: [zip_code_id], references: [id])
  favoriteAddresses FavoriteAddress[]

  @@map("addresses")
}

model FavoriteAddress {
  user_id    Int
  address_id Int

  info Json

  created_at DateTime  @default(now())
  updated_at DateTime?

  user    User    @relation(fields: [user_id], references: [id])
  address Address @relation(fields: [address_id], references: [id])

  @@id([user_id, address_id])
  @@map("favorite_addresses")
}

model Tag {
  id Int @id @default(autoincrement())

  name String @unique

  created_at DateTime  @default(now())
  updated_at DateTime?

  @@map("tags")
}

model UserTag {
  user_id Int
  tag_id  Int

  created_at DateTime @default(now())

  @@id([user_id, tag_id])
  @@map("user_tag")
}
